<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD mapper 3.0//en"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="accountMapper">
	<resultMap type="account" id="accountResult">
		<id property="ano" column="ano" />
		<result property="id" column="id" />
		<result property="pwd" column="pwd" />
		<result property="email" column="email" />
		<result property="pimage" column="pimage" />
		<result property="idtype" column="idtype" />
		<result property="idtoken" column="idtoken" />
		<result property="seller" column="seller" />
		<result property="outyn" column="outyn" />
		<result property="nickname" column="nickname" />
	</resultMap>
	<resultMap type="party" id="partyResult">
		<id property="pno" column="pno" />
		<result property="ano" column="ano" />
		<result property="pname" column="pname" />
		<result property="phone" column="phone" />
		<result property="intro" column="intro" />
		<result property="id_no" column="id_no" />
		<result property="president" column="president" />
		<result property="address" column="address" />
		<result property="pconfirm" column="pconfirm" />
		<result property="econfirm" column="econfirm" />
	</resultMap>
	<select id="login" parameterType="account" resultMap="accountResult">
		<![CDATA[
			SELECT
				*
			FROM
				ACCOUNT
			WHERE
				ID = #{id}	 AND PWD = ENCRYPTION_AES.ENC_AES(#{pwd})
		]]>
	</select>
	<insert id="signupAccount" parameterType="account">
		<![CDATA[
			INSERT INTO	ACCOUNT (ano, id, pwd, email, idtype, seller, outyn, nickname)
			VALUES(seq_ano.nextval, #{id}, ENCRYPTION_AES.ENC_AES(#{pwd}), #{id}, '일반회원', 'N', 'N', #{nickname})	
		]]>
	</insert>
	<select id="loginParty" parameterType="int" resultMap="partyResult">
		<![CDATA[
			SELECT
				* 
			FROM
				PARTY
			WHERE
				ANO = #{ano}
		]]>
	</select>

	<select id="selectOldPwd" parameterType="hashmap" resultMap="accountResult">
		<![CDATA[			
			SELECT ano, id, ENCRYPTION_AES.DEC_AES(pwd) AS pwd, email, pimage, idtype, idtoken, seller, outyn, nickname FROM ACCOUNT WHERE ano=#{ano} 
		]]>
	</select>

	<update id="updatePwd" parameterType="hashmap">
		<![CDATA[
			UPDATE ACCOUNT SET pwd=ENCRYPTION_AES.ENC_AES(#{newPwd}) WHERE ano=#{ano}
		]]>
	</update>

	<update id="updateNickname" parameterType="hashmap">
		<![CDATA[
			UPDATE ACCOUNT SET nickname=#{nickname} WHERE ano=#{ano}
		]]>
	</update>

	<select id="selectAccount" parameterType="int" resultMap="accountResult">
		<![CDATA[
			SELECT * FROM ACCOUNT WHERE ano = #{ano}
		]]>
	</select>
	
	<update id="updateEmail" parameterType="hashmap">
		<![CDATA[
			UPDATE ACCOUNT SET id = #{email}, email = #{email} WHERE ano = #{ano}
		]]>
	</update>

	<select id="selectWithEmail" parameterType="account" resultMap="accountResult">

		<choose>
		<when test="email !=null">
			SELECT * FROM ACCOUNT WHERE email = #{email}
			</when>
			<otherwise>
			SELECT * FROM ACCOUNT WHERE id = #{id}
			</otherwise>
		</choose>
	</select>
	
	<insert id="insertThirdParty" parameterType="account">
	<choose>
	<when test="pimage != null">
			INSERT INTO	ACCOUNT (ano, id, email, pimage, idtype, idtoken, seller, outyn, nickname)
			VALUES(seq_ano.nextval, #{id}, #{email}, #{pimage}, '일반회원', #{idtoken},'N', 'N', #{nickname})	
		</when>
		<otherwise>
			INSERT INTO	ACCOUNT (ano, id, email,  idtype, idtoken, seller, outyn, nickname)
			VALUES(seq_ano.nextval, #{id}, #{email}, '일반회원', #{idtoken},'N', 'N', #{nickname})	
		</otherwise>
		</choose>
		<selectKey keyProperty="ano" resultType="Integer" order="AFTER">
			select seq_ano.currval from dual
		</selectKey>
	</insert>

	<select id="selectResult" parameterType="int" resultMap="partyResult">
		<![CDATA[
			SELECT pno, ano, pname, phone, intro, ENCRYPTION_AES.DEC_AES(id_no) AS id_no, president, address, pconfirm, econfirm, idimage FROM PARTY WHERE ano=#{ano}
		]]>
	</select>
	<update id="changePwd" parameterType="Account">
	UPDATE ACCOUNT
	SET PWD = ENCRYPTION_AES.ENC_AES(#{pwd}) WHERE EMAIL = #{email}
	</update>
	
	<delete id="delete" parameterType="HashMap">
	delete from notice
	where nno = #{nno} and upbno = #{upbno}
	</delete>
	<select id="selectRequestSeller">
		select * from account 
		where idtype='승인요청'
	</select>
	
	<update id="updateIdtype" parameterType="int">
		update account set idtype='승인요청' where ano=#{ano}
	</update>
</mapper>